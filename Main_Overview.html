<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
             <!-- Tabler CSS -->
        <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler.min.css" rel="stylesheet">
        <!-- Font Awesome for icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
            crossorigin="anonymous" referrerpolicy="no-referrer" />
        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">    
    <!-- The Clearmin Dashboard CSS Libraries -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="Sources/Clearmin_Dashboard_All.css">


     <!-- JQuery Datapiker -->
    <script src="Sources/datepiker/jquery.js"></script>
    <script src="Sources/datepiker/jquery.datetimepicker.full.min.js"></script>
    <link rel="stylesheet" href="Sources/datepiker/jquery.datetimepicker.min.css">
        <!-- The Clearmin Dashboard CSS Libraries -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
        <link rel="stylesheet" type="text/css" href="Sources/Clearmin_Dashboard_All.css">

    <style>
        /* Custom styles for chart and status alignment*/
        .status-chart-container {
          display: flex;
          align-items: center; /* Vertically align status and chart */
          padding-top: 20px; /* add padding from top of the page */
          }

          .status-chart-container .card{
            display:flex;
          }
         .status-chart-container .card .card-body{
            display:flex;
         }
        #task-status-chart {
            max-height: 250px; /* Adjust for desired chart height */
        }

         .table-responsive{
            max-height:400px;
            overflow-y:auto;
         }

    </style>

   
    <title>Main Overview</title>
    </head>


<body class="cm-no-transition cm-2-navbar cm-menu-toggled">



    <div id="cm-menu">
        <nav class="cm-navbar cm-navbar-turquoise">
            <div class="cm-flex"><a href="index.html" class="cm-logo"></a></div>
            <div class="btn btn-turquoise md-menu-white" data-toggle="cm-menu"></div>
        </nav>
        <div id="cm-menu-content">
            <div id="cm-menu-items-wrapper">
                <div id="cm-menu-scroller">
                    <ul class="cm-menu-items">
                        <li class="cm-submenu">
                            <a class="sf-house">Main Dashboard <span class="caret"></span></a>
                            <ul>
                                <li><a href="Main_Overview.html">Main Overview</a></li>
                                <li><a href="Main_Gantt.html" >Main Gantt</a></li>
                                <li><a href="Main_Grid.html">Main Grid</a></li>
                                <li><a href="Main_Overview.html">Main Sheet</a></li>
                                <li><a href="Main_PowerBi.html">Main PowerBi</a></li>
                            </ul>
                        </li>
                        <li class="cm-submenu" class="active">
                            <a class="sf-dashboard">Performane Dashboard <span class="caret"></span></a>
                            <ul>
                                <li><a href="Performance_Overview.html" class="active">Performane Overview</a></li>
                                <li><a href="Performance_Gantt.html" >Performane Gantt</a></li>
                                <li><a href="Performance_Grid.html">Performane Grid</a></li>
                            </ul>
                        </li>
                        <li class="cm-submenu"><a href="#" class="sf-box-full">Documentation Dashboard <span class="caret"></span></a>
                            <ul>
                                <li><a href="Documentation_Overview.html">Documentation Overview</a></li>
                                <li><a href="Documentation_Gantt.html" class="active">Documentation Gantt</a></li>
                                <li><a href="Documentation_Grid.html">Documentation Grid</a></li>
                            </ul>   
                        </li>
                        <li class="cm-submenu"><a href="#" class="sf-money">Finance Dashboard<span class="caret"></span></a>
                            <ul>
                                <li><a href="Finance_Overview.html">Finance Overview</a></li>
                                <li><a href="Finance_Gantt.html" class="active">Finance Gantt</a></li>
                                <li><a href="Finance_Grid .html">Finance Grid</a></li>
                                <li><a href="Finance_Tabulator.html">Finance Tabulator</a></li>
                                <li><a href="Finance_PR_PO_Tracker.html" class="active">PR/PO Tracker</a></li>
                                <li><a href="Finance_Expenses.html">Expenses Report</a></li>
                                <li><a href="Finance_Trial_Balance.html">Trial Balance</a></li>
                            </ul>
                        </li>
                        <li class="cm-submenu"><a href="#" class="sf-monitor">MEAL Dashboard<span class="caret"></span></a>
                            <ul>
                                <li><a href="MEAL_Overview.html">MEAL Overview</a></li>
                                <li><a href="MEAL_Gantt.html" class="active">MEAL Gantt</a></li>
                                <li><a href="MEAL_Grid.html">MEAL Grid</a></li>
                            </ul>
                        </li>
                        <li class="cm-submenu"><a href="#" class="sf-profile-group">HR Dashboard<span class="caret"></span></a>
                            <ul>
                                <li><a href="HR_Overview.html">HR Overview</a></li>
                                <li><a href="HR_Gantt.html" class="active">HR Gantt</a></li>
                                <li><a href="HR_Grid.html">HR Grid</a></li>
                            </ul>
                        </li>                           
                        <li><a href="ChatWithAI.html" class="sf-terminal">Chat with AI</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

        <header id="cm-header">

            <nav class="cm-navbar cm-navbar-default cm-navbar-slideup">
                <div class="cm-flex">
                    <div class="nav-tabs-container">
                        <ul class="nav nav-tabs">
                            <li style="border-left:1px solid #e5e5e5; border-right:1px solid #e5e5e5" id="OverviewPage" class="active"><a  href="Main_Overview.html">Main Overview</a></li>
                            <li style="border-left:1px solid #e5e5e5; border-right:1px solid #e5e5e5" id="GanttPage" ><a  href="Main_Gantt.html">Main Gantt</a></li>
                            <li style="border-left:1px solid #e5e5e5; border-right:1px solid #e5e5e5" id="GridPage"><a  href="Main_Grid.html">Main Grid</a></li>
                            <li style="border-left:1px solid #e5e5e5; border-right:1px solid #e5e5e5" id="GridPage"><a  href="Main_Sheet.html">Main Sheet</a></li>
                            <li style="border-left:1px solid #e5e5e5; border-right:1px solid #e5e5e5" id="GridPage"><a  href="Main_PowerBi.html">Main PowerBI</a></li>
                        </ul>
                    </div>
                </div>
                               
       
                <div class="pull-right" style="border-left:1px solid #e5e5e5"><a title="Edit Settings" class="btn btn-default btn-light md-settings" data-bs-toggle="offcanvas" href="#settingbtn" role="button" aria-controls="offcanvasRight"></a></div>
            </nav>


            
        </header>




        <div id="global">
          
            <div class="content">
                <div class="container-xl">
                    <div class="row status-chart-container">
                        <!-- Total Tasks Card -->
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-body">
                                    <div class="subheader">Total Tasks</div>
                                    <div class="h1 mb-0" id="total-tasks">0</div>
                                </div>
                            </div>
                        </div>
                        <!-- Task Status Pie Chart -->
                       <div class="col-md-8">
                            <div class="card">
                               <div class="card-header">
                                    <h3 class="card-title">Task Status</h3>
                                </div>
                                <div class="card-body">
                                     <canvas id="task-status-chart"></canvas>
                                 </div>
                            </div>
                        </div>
                    </div>
                     <!-- Recent Tasks Table -->
                    <div class="row mt-3">
                      <div class="col-12">
                          <div class="card">
                              <div class="card-header">
                                  <h3 class="card-title">Recent Tasks within 30 Days</h3>
                              </div>
                              <div class="table-responsive">
                                  <table class="table card-table table-vcenter text-nowrap datatable">
                                      <thead>
                                          <tr>
                                              <th>WBS Code</th>
                                              <th>Task Name</th>
                                              <th>Status</th>
                                              <th>Public Comments</th>
                                              <th>Private Comments</th>
                                              <th>Notes</th>
                                          </tr>
                                      </thead>
                                      <tbody id="recent-tasks-table-body">
                                          <!-- Table rows will be inserted here by JS -->
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                      </div>
                  </div>
                </div>
            </div>
        </div>


</div>


<script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/js/tabler.min.js"></script>
<script>

var xhReq = new XMLHttpRequest();
xhReq.open("GET", "https://fir-slickgrid-app-default-rtdb.firebaseio.com/tasks.json", false);
xhReq.send(null);
var jsonObject = JSON.parse(xhReq.responseText);


    // Data from the array
    const tasksData = jsonObject; // <---- Empty array, Paste your JSON here later.

    // Get the total task count
    document.getElementById('total-tasks').textContent = tasksData.length;

    // Prepare data for the pie chart
    const statusCounts = tasksData.reduce((acc, task) => {
        acc[task.status] = (acc[task.status] || 0) + 1;
        return acc;
    }, {});

    const labels = Object.keys(statusCounts);
    const data = Object.values(statusCounts);

    // Create pie chart
    const ctx = document.getElementById('task-status-chart').getContext('2d');
    const taskStatusChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: [
                    '#206bc4', //blue
                    '#5eba00', //green
                    '#ffc107', // yellow
                    '#e34d4d', //red
                   '#94a3b8', //gray
                     '#f0abfc', //pink
                     '#65a30b', //green
                    '#3b82f6', //blue

                     '#3b82f6', //blue
                ],
            }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false, // Allow chart to adapt to its container
        }
    });

      // Function to check if a date is within the last 30 days
     function isRecentDate(startDate) {
        if (!startDate) return false;
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
        const taskDate = new Date(startDate); // Convert milliseconds timestamp to Date
        return taskDate >= thirtyDaysAgo;
     }


    // Get recent tasks
     const recentTasks = tasksData.filter(task => isRecentDate(task.start_date));


    // Populate recent tasks table
    const recentTasksTableBody = document.getElementById('recent-tasks-table-body');

    recentTasks.forEach(task => {
      const row = document.createElement('tr');
      row.innerHTML = `
          <td>${task.WBS_Code || ''}</td>
          <td>${task.text || ''}</td>
          <td>${task.status || ''}</td>
          <td>${task.public_comments || ''}</td>
          <td>${task.private_comments || ''}</td>
          <td>${task.notes || ''}</td>
      `;
      recentTasksTableBody.appendChild(row);
    });


</script>


    <!-- The Clearmin Dashboard JavaScript Libraries -->
        <script src="Sources/Clearmin_Dashboard_All.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    </body>
</html>
